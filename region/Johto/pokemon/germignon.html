
<!doctype html><html lang="fr"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title id="title">Pokmon</title>
<link rel="stylesheet" href="../assets/style.css">
<script defer src="../assets/app.js"></script>
<style>
.sprite{width:192px;height:auto;border-radius:12px;border:1px solid #252a43;background:#0e1122;padding:8px}
.headerWrap{display:flex;gap:16px;align-items:center}
</style>
</head><body onload="initPokemon()">
<div class="container">
  <div class="header">
    <div class="h1" id="title">Pokmon</div>
    <div class="nav">
      <a href="../index.html">Accueil</a>
      <a href="../pokedex.html">Pokdex</a>
      <a href="../moves.html">Attaques</a>
    </div>
  </div>
  <div class="card">
    <div class="headerWrap">
      <img id="sprite" class="sprite" alt="Sprite" src="" onerror="this.style.display='none'">
      <div>
        <div class="kv">
          <div><b>Types</b></div><div id="types"></div>
          <div><b>volution</b></div><div id="evo">?</div>
          <div><b>Talents</b></div><div id="habil">?</div>
          <div><b>Talent cach</b></div><div id="habhid">?</div>
        </div>
      </div>
    </div>
    <hr>
    <div class="h2">Capacits par niveau</div>
    <ul class="list" id="lvl"></ul>
    <div class="h2">Capacits par reproduction</div>
    <ul class="list" id="eggs"></ul>
    <div class="h2">CS</div>
    <ul class="list" id="cs"></ul>
    <div class="h2">CT</div>
    <ul class="list" id="ct"></ul>
    <div class="h2">DT</div>
    <ul class="list" id="dt"></ul>
    <hr>
    <div class="h2">Objet tenu & Ressource</div>
<ul id="objres"></ul>

<div class="h2">Pokdex</div>
    <p class="p" id="pokedex">?</p>
  </div>
</div>
<script>
// Utilise le fallback pkm -> pkm2 si l'image déclarée ne charge pas
const _initPokemonOrig = window.initPokemon;

window.initPokemon = async function () {
  // laisse l'init global faire son boulot (types/texte/etc.)
  try { await _initPokemonOrig?.(); } catch (e) { console.warn(e); }

  // Nom de la page (ex: "germignon" depuis germignon.html)
  const name = decodeURIComponent(location.pathname.split('/').pop().replace('.html','')).toLowerCase();
  // Région depuis le chemin (ex: /region/Johto/...)
  const m = decodeURIComponent(location.pathname).match(/\/region\/([^/]+)/i);
  const rk = (m ? m[1] : 'Johto').toLowerCase();

  // Charge le pokédex (chemin compatible GitHub Pages)
  let data = [];
  try {
    data = await loadJSON(withBase(`/data/pokedex_${rk}.json`));
  } catch (e) {
    console.error('Chargement pokedex échoué:', e);
    return;
  }

  const p = data.find(x => x.name.toLowerCase() === name);
  const img = document.getElementById('sprite');
  if (!img) return;

  // 1) Si le JSON fournit p.image, on tente d'abord celui-ci
  if (p && p.image) {
    const path = p.image.startsWith('/') ? p.image : `/${p.image}`;
    img.onerror = () => {
      // 2) En cas d'échec, on passe en fallback automatique pkm -> pkm2
      setSprite(img, name, rk);
    };
    img.src = withBase(path);
    img.style.display = 'block';
    return;
  }

  // 3) Sinon, fallback direct (cherche dans assets/pkm puis assets/pkm2)
  setSprite(img, name, rk);
  img.style.display = 'block';
};
</script>

</body></html>







